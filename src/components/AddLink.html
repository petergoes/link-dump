<Dialog 
	title="Add link"
	ref:dialog
	on:close="onClose(event)">
	{{#if collectionId}}
		<label>
			<div>Collection</div>
			<input ref:collection value="{{ collectionTitle }}" disabled />
		</label>	
	{{else}}
		<label>
			<div>Collection</div>		
				<select ref:collection>
					{{#each $collectionNames as collection}}
						<option value="{{ collection.id }}">{{ collection.title }}</option>
					{{/each}}
				</select>
		</label>
	{{/if}}
	<label>
		<div>Label</div>
		<input ref:label />
	</label>
	<label>
		<div>Url</div>
		<input ref:url />
	</label>
</Dialog>

<script>
	import Dialog from './Dialog.html';
	import store from '../store';

	const initialData = {
		collectionId: null
	}

	export default {
		store: () => store,
		data() {
			return initialData
		},
		components: {
			Dialog,
		},
		computed: {
			collectionTitle: (collectionId, $collectionNames) => {
				const collection = $collectionNames.find(collection => collection.id === collectionId);
				return collection ? collection.title : '';
			}
		},
		methods: {
			show(collectionId) {
				this.set({ collectionId });
				this.refs.dialog.show();
			},
			add() {
				const collectionId = this.refs.collection.value;
				const label = this.refs.label.value;
				const url = this.refs.url.value;
				this.store.addLink(collectionId, label, url);
			},
			onClose(action) {
				if (action === 'confirm') {
					this.add();
				}
				this.set(initialData);
			}
		}
	}

</script>
